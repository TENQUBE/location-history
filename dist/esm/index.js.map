{"version":3,"file":"index.js","sources":["../../src/src/lib/vos/location.ts","../../src/src/lib/index.tsx"],"sourcesContent":["interface ILocationVO {\n  readonly hash: string\n  readonly host: string\n  readonly hostname: string\n  readonly href: string\n  readonly origin: string\n  readonly pathname: string\n  readonly port: string\n  readonly protocol: string\n  readonly search: string\n  \n  readonly searchObj: unknown\n  readonly hashObj: unknown\n}\n\nclass LocationVO implements ILocationVO {\n  \n  readonly hash: string\n  readonly host: string\n  readonly hostname: string\n  readonly href: string\n  readonly origin: string\n  readonly pathname: string\n  readonly port: string\n  readonly protocol: string\n  readonly search: string\n  \n  readonly searchObj: unknown\n  readonly hashObj: unknown\n\n  constructor() {\n    const { hash, host, hostname, href, origin, pathname, port, protocol, search } = document.location\n\n    this.host = host\n    this.hostname = hostname\n    this.href = href\n    this.origin = origin\n    this.pathname = pathname\n    this.port = port\n    this.protocol = protocol\n\n    this.hash = hash.substring(1)\n    this.search = search.substring(1)\n\n    this.hashObj = this.groupParamsByKey(new URLSearchParams(this.hash))\n    this.searchObj = this.groupParamsByKey(new URLSearchParams(this.search))\n  }\n\n  private groupParamsByKey(params: URLSearchParams) {\n    return [...params.entries()].reduce((acc, tuple) => {\n      const [key, val] = tuple\n      if(acc.hasOwnProperty(key)) {\n         if(Array.isArray(acc[key])) {\n           acc[key] = [...acc[key], val]\n         } else {\n           acc[key] = [acc[key], val]\n         }\n      } else {\n       acc[key] = val\n      }\n      return acc\n    }, {})\n  }\n\n  equals(obj: unknown) {\n    return Object.entries(this).sort().toString() === Object.entries(obj).sort().toString()\n  }\n  \n}\n\nexport { ILocationVO }\nexport default LocationVO","import { useEffect, useRef, useCallback, useState, createContext, useContext } from \"react\"\nimport LocationVO, { ILocationVO } from \"./vos/location\"\n\n\ninterface ILocationHistory {\n  list: ILocationVO[],\n  before: ILocationVO | null\n}\n\ntype ReturnTypes = [ILocationHistory, (newHistory: ILocationHistory) => void]\n\nconst LocationContext = createContext(null)\n\nconst useLocationHistory = (): ReturnTypes => {\n  const observer = useRef<MutationObserver>()\n\n  const [history, setHistory] = useContext(LocationContext)\n\n  const setInitHistory = useCallback(() => {\n    if(history.list.length > 0) return\n    setHistory({\n      list: [new LocationVO()],\n      before: null\n    })\n  }, [history])\n\n  const addObserver = useCallback(() => {\n    const len = history.list.length\n    let oldHref = document.location.href\n    \n    if(observer.current) observer.current.disconnect()\n    observer.current = new MutationObserver(() => {\n      if (oldHref !== document.location.href) {\n        oldHref = document.location.href\n\n        const newBefore = len > 0 ? history.list[len - 1] : null\n        const newLocation = new LocationVO()\n\n        if(len > 1 && history.list[len-2].href === newLocation.href) {\n          setHistory({\n            list: history.list.slice(0, len - 1),\n            before: newBefore\n          })\n        } else {\n          const list = [...history.list, newLocation]\n          setHistory({\n            list,\n            before: newBefore\n          })\n        }\n      }\n    })\n\n    observer.current.observe(document.body, { childList: true, subtree: true, attributes: true })\n  }, [history])\n\n  useEffect(() => {    \n    setInitHistory()\n    addObserver()\n  }, [history])\n\n  return [history, setHistory]\n}\n\n\nconst LocaitonHistoryProvider = ({ children }) => {\n  const [history, setHistory] = useState<ILocationHistory>({\n    list: [],\n    before: null\n  })\n\n  const observerTrigger = useCallback(() => {\n    document.body.setAttribute('data-lh-update', String(new Date().getTime()))\n  }, [])\n\n  useEffect(() => {\n    window.history.pushState = new Proxy(window.history.pushState, {\n      apply: (target, thisArg, argArray) => {\n        observerTrigger()\n        return target.apply(thisArg, argArray)\n      }\n    })\n\n    window.addEventListener('popstate', observerTrigger)\n    return () => {\n      window.removeEventListener('popstate', observerTrigger)\n    }\n  }, [])\n\n  return (\n    <LocationContext.Provider value={[history, setHistory]}>\n      {children}\n    </LocationContext.Provider>\n  )\n}\n\n\nexport { useLocationHistory, LocationVO, ILocationVO, ILocationHistory }\nexport default LocaitonHistoryProvider"],"names":["_jsx"],"mappings":"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"}